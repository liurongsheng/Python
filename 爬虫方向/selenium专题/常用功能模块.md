# 常用功能模块

[官方文档](https://selenium-python.readthedocs.io/index.html) https://selenium-python.readthedocs.io/index.html

PhantomJS是一个基于Webkit的"无界面"(headless)浏览器，它会把网站加载到内存并执行页面上的JavaScript，
因为不会展示图形界面，所以运行起来比完整的浏览器更高效，用来抓取js渲染后的代码
[下载链接](https://bbuseruploads.s3.amazonaws.com/fd96ed93-2b32-46a7-9d2b-ecbc0988516a/downloads/98d51451-997f-40e3-b9e6-a8e635dcdcb3/phantomjs-2.1.1-windows.zip?Signature=bWm8rmXB1Y9AT2GMaR6PPNSTbZA%3D&Expires=1542273331&AWSAccessKeyId=AKIAIQWXW6WLXMB5QZAQ&versionId=null&response-content-disposition=attachment%3B%20filename%3D%22phantomjs-2.1.1-windows.zip%22)
由于 PhantomJS 宣布暂停更新，新版的 Selenium 已经不支持 PhantomJS。现在是用 ChromeHeadless

全局 driver 
```
options = webdriver.ChromeOptions()
driver_path = r"d:\gitHub\chromedriver.exe"
driver = webdriver.Chrome(executable_path=driver_path, chrome_options=options)
```

- 刷新页面
`driver.refresh()`

- 浏览器前进
`driver.forward()` 

- 浏览器后退
`driver.back()`

- 关闭窗口
`driver.close()`

- 全屏
`driver.fullscreen_window()`

- 最大化窗口
`driver.maximize_window()`

- 最小化窗口
`driver.minimize_window()`

- 获取窗口位置
- 获取窗口大小
- 同时获取窗口位置和大小
```console
print(driver.get_window_position())
print(driver.get_window_size())
print(driver.get_window_rect())
{'x': 10, 'y': 10}
{'width': 945, 'height': 1020}
{'height': 1020, 'width': 945, 'x': 10, 'y': 10}
```

- 设置窗口位置
- 设置窗口大小
- 同时设置窗口位置和大小
```console
driver.set_window_position(30,30)
driver.set_window_size(500,500)
driver.set_window_rect(10,10,1050,708)
```

将滚动条移动到页面的底部
```
js = "document.documentElement.scrollTop = 100000"
driver.execute_script(js)
```
将滚动条移动到页面的顶部 
```
js = "document.documentElement.scrollTop = 0"
driver.execute_script(js)
```
对页面中的内嵌窗口中的滚动条进行操作，要先定位到该内嵌窗口，在进行滚动条操作 
```
js="var q = document.getElementById('id').scrollTop = 100000" 
driver.execute_script(js)
```
键盘按键操作需要引入keys包
```
from selenium.webdriver.common.keys import Keys
```

截屏
```
driver.save_screenshot("baidu.png")
```

获取当前url
```
driver.current_url
```

最后再使用BeautifulSoup，解析图片标签：
```
html = BeautifulSoup(browser.page_source, "lxml")
imgs = html.select("#new_list li img")
```

## 查找元素
- find_element_by_name 通过name查找单个元素
- find_element_by_xpath 通过xpath查找单个元素
- find_element_by_link_text 通过链接查找单个元素
- find_element_by_partial_link_text 通过部分链接查找单个元素
- find_element_by_tag_name 通过标签名称查找单个元素
- find_element_by_class_name 通过类名查找单个元素
- find_element_by_css_selector 通过css选择武器查找单个元素
- find_elements_by_name 通过name查找多个元素
- find_elements_by_xpath 通过xpath查找多个元素
- find_elements_by_link_text 通过链接查找多个元素
- find_elements_by_partial_link_text 通过部分链接查找多个元素
- find_elements_by_tag_name 通过标签名称查找多个元素
- find_elements_by_class_name 通过类名查找多个元素
- find_elements_by_css_selector 通过css选择武器查找多个元素

具体实现
方式一 
```
cheese = driver.find_element_by_partial_link_text("cheese")
```

方式二
```
from selenium.webdriver.common.by import By
cheese = driver.find_element(By.PARTIAL_LINK_TEXT, "cheese")
```

## 获元素取值
- size 获取元素的尺寸
- text 获取元素的文本
- get_attribute(name) 获取属性值
- location 获取元素坐标，先找到要获取的元素，再调用该方法
- page_source 返回页面源码
- driver.title 返回页面标题
- current_url 获取当前页面的URL
- is_displayed() 设置该元素是否可见
- is_enabled() 判断元素是否被使用
- is_selected() 判断元素是否被选中
- tag_name 返回元素的tagName
- clear() 清空输入

## 鼠标事件 
- context_click(elem) 右击鼠标点击元素elem，另存为等行为
- double_click(elem) 双击鼠标点击元素elem，地图web可实现放大功能
- drag_and_drop(source,target) 拖动鼠标，源元素按下左键移动至目标元素释放
- move_to_element(elem) 鼠标移动到一个元素上
- click_and_hold(elem) 按下鼠标左键在一个元素上
- perform() 在通过调用该函数执行ActionChains中存储行为

from selenium.webdriver.common.action_chains import ActionChains

## 获取 cookie
- driver.get_cookies() 获取全部的 cookie 信息 
- driver.get_cookie(key) 获取指定 key 的 cookie 信息 
- add_cookie(cookie_dict) 添加cookie, cookie_dict like as {'name':'username','value':'super'}
- delete_all_cookies():删除所有cookie信息
- delete_cookie(name, optionsString) 删除cookie信息。
  "name"是要删除的 cookie 的名称，"optionsString" 是该cookie的选项，目前支持的选项包括"路径"、"域"

## 设置 localStorge
token = [{"domain": ".jd.com", "expiry": 2406160774}]
driver.execute_script('localStorage.setItem("token", JSON.stringify( %s ))' % json.dumps(token))
print(driver.execute_script("return localStorage.token"))

## 移动到视窗
target = driver.find_element_by_id("m_1_4")
driver.execute_script("arguments[0].scrollIntoView();", target)

## 查看当前 python 版本号
import sys
sys.version_info



## 未测试
find_element_by_link_text 
click_button = driver.find_element_by_link_text(str(u"发现好店".encode('utf-8')))
