from time import sleep, time, mktime, strptime, strftime, localtime
from selenium import webdriver

TargetTimeInput = "2018-11-12 20:00:00"
TargetTime = mktime(strptime(TargetTimeInput, '%Y-%m-%d %H:%M:%S'))
url_login = 'https://plogin.m.jd.com/user/login.action?appid=300&returnurl=https%3A%2F%2Fwqlogin1.jd.com%2Fpassport%2FLoginRedirect%3Fstate%3D140060197%26returnurl%3Dhttps%253A%252F%252Fpro.m.jd.com%252Fmall%252Factive%252FLU6CDCkfsHiC9udoD6BDcRdcHmT%252Findex.html%253Futm_source%253Dkong%2526utm_medium%253Dzssc%2526utm_campaign%253Dt_1000027277_102033%2526utm_term%253D1095a63f-1680-45e2-8fdf-7e46a574f02f-p_1999-pr_1383-at_102033%2526jd_pop%253D1095a63f-1680-45e2-8fdf-7e46a574f02f%2526abt%253D0&source=wq_passport'
url = 'https://pro.m.jd.com/mall/active/LU6CDCkfsHiC9udoD6BDcRdcHmT/index.html?utm_source=kong&utm_medium=zssc&utm_campaign=t_1000027277_102033&utm_term=1095a63f-1680-45e2-8fdf-7e46a574f02f-p_1999-pr_1383-at_102033&jd_pop=1095a63f-1680-45e2-8fdf-7e46a574f02f&abt=0'

def clickTarget(driver, url):
    # driver.add_cookie(cookie_dict=savedCookies)
    driver.get(url)
    sleep(3)
    click_button = driver.find_element_by_id('m_1_4')
    ClickNum = 3000
    while 1:
        if TargetTime - time() < 1:
            while ClickNum > 0:
                click_button.click()
                print("机器人点击了一次")
                ClickNum = ClickNum - 1
                sleep(0.1)

        sleep(1)

def loginPage(driver, url_login, url):
    driver.get(url_login)
    # driver.maximize_window()
    sleep(1)
    driver.find_element_by_xpath("//input[@id='username']").send_keys("18750763136")
    driver.find_element_by_xpath("//input[@id='password']").send_keys("liurongsheng67")
    loginButton = driver.find_element_by_id('loginBtn')
    loginButtonClickNum = 5
    while loginButtonClickNum > 0:
        loginButton.click()
        print("登录点击一次")
        # if(driver.find_element_by_id('loginBtn'))
        loginButtonClickNum = loginButtonClickNum -1
        sleep(1)

    clickTarget(driver, url)

if __name__ == '__main__':
    mobileEmulation = {'deviceName': 'iPhone 6'}
    # 设置代理
    # options.add_argument("--proxy-server=http://127.0.0.1:8087")
    options = webdriver.ChromeOptions()
    options.add_experimental_option('mobileEmulation', mobileEmulation)

    driver_path = r"d:\gitHub\chromedriver.exe"
    driver = webdriver.Chrome(executable_path=driver_path,chrome_options=options)
    CountTime = TargetTime - time()
    print("抢券目标时间 %s" % strftime('%Y-%m-%d %H:%M:%S', localtime(TargetTime)) )
    print("当前时间 %s" % strftime('%Y-%m-%d %H:%M:%S', localtime(time())) )
    print(CountTime)
    while CountTime > 180:
        print("抢券倒计时：%s 分 %s 秒" % (abs(int(CountTime)) // 60, abs(int(CountTime)) % 60))
        CountTime = CountTime - 1
        sleep(1)

    if CountTime < 0:
        print("抢券时间已经到了，火速登录抢券！")
    else:
        print("时间不到3分钟了，跳转去登录抢券！")
    loginPage(driver, url_login, url)


    # savedCookies = driver.get_cookies()
    # print(savedCookies)

    # 移动到视窗
    # target = driver.find_element_by_id("m_1_4")
    # driver.execute_script("arguments[0].scrollIntoView();", target)


